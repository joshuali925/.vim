#!/usr/bin/env bash
source ~/.vim/bin/_install_from_github.sh
run-if-exists "$0" "$@"
detect-env

# Windows: https://www.gyan.dev/ffmpeg/builds/
# Linux static: https://johnvansickle.com/ffmpeg/
case $PLATFORM:$ARCHITECTURE in
  linux:x86_64) url=https://github.com/BtbN/FFmpeg-Builds/releases/download/latest/ffmpeg-master-latest-linux64-gpl.tar.xz ;;
  linux:arm64) url=https://github.com/BtbN/FFmpeg-Builds/releases/download/latest/ffmpeg-master-latest-linuxarm64-gpl.tar.xz ;;
  darwin:x86_64) url=https://evermeet.cx/ffmpeg/ffmpeg-8.0.7z ;;
  darwin:arm64) url=https://www.osxexperts.net/ffmpeg80arm.zip ;;
  *) echo "package not found for '${0##*/}' on $PLATFORM $ARCHITECTURE, exiting.." >&2; exit 1 ;;
esac

[ "$PLATFORM" = 'linux' ] && extract_flags='--strip-components=2 --wildcards ffmpeg*/bin/ffmpeg ffmpeg*/bin/ffprobe'
install-archive-from-url "$url" ffmpeg "$extract_flags" "$@"
