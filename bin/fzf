#!/usr/bin/env bash
source ~/.vim/bin/_install_from_github.sh
detect-env
if [ ! -x $HOME/.local/bin/fzf ] && [ "$PLATFORM" == 'darwin' ]; then
  mkdir -p $HOME/.local/bin
  if [ "$ARCHITECTURE" == 'x86_64' ]; then
    URL=$(curl -s https://api.github.com/repos/junegunn/fzf/releases/latest | grep "browser_download_url.*darwin_amd64" | cut -d '"' -f 4)
  else
    URL=$(curl -s https://api.github.com/repos/junegunn/fzf/releases/latest | grep "browser_download_url.*darwin_arm64" | cut -d '"' -f 4)
  fi
  echo "Installing fzf from $URL" >&2
  curl -sL -o $HOME/.local/bin/fzf.zip $URL
  unzip $HOME/.local/bin/fzf.zip -d $HOME/.local/bin >&2 && rm $HOME/.local/bin/fzf.zip
  chmod +x $HOME/.local/bin/fzf
  $HOME/.local/bin/fzf "$@"
else
  install-from-github fzf junegunn/fzf linux_amd64 linux_arm64 '' '' '' "$@"
fi
